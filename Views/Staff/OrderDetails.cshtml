@using FoodTruck.Web.Models.Enums
@model FoodTruck.Web.Models.Order

@{
    ViewData["Title"] = $"Order #{Model.Id}";
}

<h2>Order #@Model.Id</h2>

<div class="row">
    <div class="col-md-6">
        <div class="card mb-3">
            <div class="card-header">
                <strong>Order Information</strong>
            </div>
            <div class="card-body">
                <p><strong>Status:</strong> @await Html.PartialAsync("_StatusBadgePartial", Model.Status)</p>
                <p><strong>Placed:</strong> @Model.CreatedAt.ToLocalTime()</p>
                <p><strong>Customer:</strong> @Model.ContactName</p>
                <p><strong>Phone:</strong> @Model.ContactPhone</p>
                @if (!string.IsNullOrWhiteSpace(Model.ContactEmail))
                {
                    <p><strong>Email:</strong> @Model.ContactEmail</p>
                }
                <p><strong>Total:</strong> @Model.Total.ToString("C")</p>
                
                @if (Model.PickupEta.HasValue)
                {
                    <p><strong>Pickup ETA:</strong> @Model.PickupEta.Value.ToLocalTime()</p>
                }
                
                @if (!string.IsNullOrWhiteSpace(Model.CancelReason))
                {
                    <div class="alert alert-danger mt-2">
                        <strong>Cancel Reason:</strong> @Model.CancelReason
                    </div>
                }
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card mb-3">
            <div class="card-header">
                <strong>Order Items</strong>
            </div>
            <div class="card-body">
                @if (Model.Items != null && Model.Items.Any())
                {
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th class="text-center">Qty</th>
                                <th class="text-end">Price</th>
                                <th class="text-end">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Items)
                            {
                                var lineTotal = item.UnitPrice * item.Quantity;
                                <tr>
                                    <td>
                                        @item.MenuItem?.Name
                                        @if (!string.IsNullOrWhiteSpace(item.Notes))
                                        {
                                            <br /><small class="text-muted">Notes: @item.Notes</small>
                                        }
                                    </td>
                                    <td class="text-center">@item.Quantity</td>
                                    <td class="text-end">@item.UnitPrice.ToString("C")</td>
                                    <td class="text-end">@lineTotal.ToString("C")</td>
                                </tr>
                            }
                        </tbody>
                        <tfoot>
                            <tr>
                                <th colspan="3" class="text-end">Total:</th>
                                <th class="text-end">@Model.Total.ToString("C")</th>
                            </tr>
                        </tfoot>
                    </table>
                }
                else
                {
                    <p class="text-muted">No items in this order.</p>
                }
            </div>
        </div>
    </div>
</div>

<div class="mt-3">
    <a asp-action="EditOrder" asp-route-id="@Model.Id" class="btn btn-primary">Edit Order</a>
    <a asp-action="OrderQueue" class="btn btn-secondary">Back to Queue</a>
</div>
